@model ProyectoFinalDraft.Models.Cita

@{
    ViewData["Title"] = "Create";
    }

<h1>Agendar Cita</h1>
<hr />

<form asp-action="Create" class="col-md-5">

    <!-- Fecha -->
    <div class="form-group mb-2">
        <label asp-for="Fecha"></label>
        <input asp-for="Fecha" class="form-control" />
    </div>

    <!-- Detalle -->
    <div class="form-group mb-2">
        <label asp-for="Detalle"></label>
        <input asp-for="Detalle" class="form-control" />
    </div>
    <!-- La Cita se agenda siempre como "Agendada"-->
    <input type="hidden" name="Estado Cita" value="2" />


    <!-- Cliente -->
    <div class="form-group mb-2">
        <label asp-for="UsuarioId">Cliente</label>
        <select asp-for="UsuarioId" class="form-control" asp-items="ViewBag.UsuarioId"></select>
    </div>

    <!-- Servicio Único -->
    <div class="form-group mb-2">
        <label>Servicio</label>
        <select id="servicio"
                class="form-control"
                name="ServiciosSeleccionados"
                onchange="calcular()">

            <option value="">Seleccione un servicio</option>

            @foreach (var servicio in (IEnumerable<ProyectoFinalDraft.Models.Servicio>)ViewData["Servicios"])
                {
                <option value="@servicio.ServicioId"
                        data-precio="@servicio.Precio">
                    @servicio.Nombre (₡@servicio.Precio)
                </option>
                }
        </select>

    </div>

    <!-- Totales -->
    <div class="mt-3">

        <strong>Subtotal: </strong> <span id="tSub">₡0.00</span><br />
        <strong>IVA (13%): </strong> <span id="tIVA">₡0.00</span><br>
        <strong>Total: </strong> <span id="tTotal">₡0.00</span>
    </div>

    <!-- Botón Crear -->
    <div class="form-group mt-3">
        <input type="submit" value="Crear Cita" class="btn btn-primary" />
    </div>

</form>

    @section Scripts {
    <script>
        function calcular() {
            const select = document.getElementById("servicio");
            const precio = parseFloat(select.options[select.selectedIndex]?.dataset?.precio || 0);

            // Cálculos correctos
            const subtotal = precio;       // precio original
            const iva = subtotal * 0.13;   // 13% de IVA
            const total = subtotal + iva;  // total final

            // Mostrar valores
            document.getElementById("tSub").innerText = "₡" + subtotal.toFixed(2);
            document.getElementById("tIVA").innerText = "₡" + iva.toFixed(2);
            document.getElementById("tTotal").innerText = "₡" + total.toFixed(2);
        }
    </script>
    }
